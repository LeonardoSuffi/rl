<form action="/z.php" id="l1" method="post">
    <input type="text" id="nome" name="nome" class="nome" placeholder="Seu Nome" required>
    <br>
    <input type="email" id="email" name="email" class="email" placeholder="E-mail" required>
    <br>
    <input type="tel" name="tel" id="tel" class="tel" placeholder="Tel: (00) 90000-0000" required/><br>
    
    <button type="submit" class="button b1">
      <i class="fi fi-rs-car-alt" style="margin-right: 6px;"></i>
      <span>Quero vender meu carro</span>
    </button>
  </form>
  
  <div id="msg" class="show" style="display:none;">
    <p class="thanks">Obrigado <span style="font-size: 35px; vertical-align:0px;" class="heart">&hearts;</span></p>
    <p class="message">Agradecemos por seu cadastro. Em instantes entraremos em contato!<br> Caso possua alguma d√∫vida, entre direto em nosso WhatsApp</p>
    <button class="button b1" id="wt1">
      <i class="fi fi-rs-car-alt" style="margin-right: 6px;"></i>
      <span>Falar Pelo whatsapp</span>
    </button>
  </div>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.js"></script>
  <script>
  $(document).ready(function () {
    $("#tel").mask("(00) 00000-0000");
  });
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('l1').addEventListener('submit', function(event) {
        event.preventDefault();
  
        var formData = new FormData(this);
  
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/z.php', true);
        xhr.onload = function() {
            if (xhr.status === 200) {
                document.getElementById('l1').style.display = 'none';
                document.getElementById('msg').style.display = 'block';
                piperun(formData);
            }
        };
        xhr.send(formData);
    });
  });
  </script>
  
  <script>
    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      let regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
      return results === null
        ? ""
        : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
  
    function piperun(formData) {
      let endpointHash = "https://app.pipe.run/webservice/integradorJson?hash=7607b06d-9703-4b89-bc1c-3e8a4bcf30e8";
      let name = formData.get('nome');
      let email = formData.get('email');
      let phone = formData.get('tel');
      let utm_source = getParameterByName("utm_source");
      let utm_campaign = getParameterByName("utm_campaign");
  
      function configPost(method, body) {
        return {
          method: method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        };
      }
  
      let rules = {
        update: true,
        filter_status_update: "open",
        status: "open",
      };
  
      let lead = [
        {
          id: email,
          title: name.toUpperCase(),
          mobile_phone: phone,
          name: name,
          email: email,
          last_conversion: {
            source: "Site Principal",
          },
          custom_fields: {
              url_conversao: location.href,
              utm_source: utm_source,
              utm_campaign: utm_campaign,
          },
        },
      ];
  
      let dataToSend = {
        rules: rules,
        leads: lead,
      };
  
      fetch(endpointHash, configPost("POST", dataToSend)).then((response) => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        // You can handle success response here if needed
      }).catch((error) => {
        console.error('There was a problem with the fetch operation:', error);
      });
    };
  </script>
  